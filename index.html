<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>Blank Page</title>
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<style type="text/css" media="screen">
</style>
</head>
<body>
<h1>Map Game</h1>
    <style>
        html, body, #map-canvas 
        {
        width: 100%;
        height: 100%;
        margin: 0;
        padding: 0;
        }
    </style>
    <script src="https://maps.googleapis.com/maps/api/js?v=3.exp"></script>
    <script>
function initialize() 
{
    var config = 
    { 
        'target_type': 'latlng',
        'target': new google.maps.LatLng(27.175015 , 78.042155),
        'centerlatlng': new google.maps.LatLng(0, 0)
    };

    var mapOptions = 
    {
        zoom: 3,
        center: config.centerlatlng,
        disableDefaultUI : true,
        mapTypeId: google.maps.MapTypeId.SATELLITE
    }
    var map = new google.maps.Map(document.getElementById('map-canvas'), mapOptions);

    var marker = new google.maps.Marker(
    {
        position: config.centerlatlng,
        map: map,
        draggable: true,
        title: 'Your Guess'
    });

    google.maps.event.addListener(marker, 'mouseup', function() 
    {
        // If the marker hasn't been moved we don't want to do anything:
        if ( config.centerlatlng.B == this.position.B && config.centerlatlng.k == this.position.k )
        {
            return false;
        }
    
        // Check how far the click was from the target.
        // There are two types of target checks: Lat-Long, used for small cities or foreign cities
        // (cities smaller than five miles wide, or cities we don't have boundary data for), and
        // boundary target checks. For boundary checks we need the KML string for the boundary.
        if ( config.target_type == 'latlng' )
        {
            // k is lat, B is long in Google maps.
            distance = great_circle(config.centerlatlng.k, this.position.k, config.centerlatlng.B, this.position.B);
            $('#result').text('Your guess landed ' + distance + ' miles from the target');
            console.log(distance, ' miles');
        }
    });
/*
var ctaLayer = new google.maps.KmlLayer({
    //url: 'http://www.colorado.gov/maps/ez/cntybnd2001v5.kml'
    url: 'http://www2.census.gov/geo/tiger/GENZ2013/cb_2013_us_nation_500k.kmz'
  });
  ctaLayer.setMap(map);
console.log(ctaLayer);
*/
}

google.maps.event.addDomListener(window, 'load', initialize);

Math.radians = function (degrees)
{
    return degrees * (Math.PI / 180);
}

function great_circle(lat1, lon1, lat2, lon2)
{
    // Calculate the distance between two sets of lat/longs.
    // Cribbed from http://stackoverflow.com/questions/5260423/torad-javascript-function-throwing-error/7179026#7179026
    var R = 3958.7558657440545; // Radius of earth in Miles
    var dLat = Math.radians(lat2-lat1);
    var dLon = Math.radians(lon2-lon1);
    var a = Math.sin(dLat/2) * Math.sin(dLat/2) +
            Math.cos(Math.radians(lat1)) * Math.cos(Math.radians(lat2)) * 
            Math.sin(dLon/2) * Math.sin(dLon/2);
    var c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
    var d = R * c;
    return d;
}

function log_answer(slug, distance)
{
    // Send a request to a remote server to log how far the guess was from the mark
}
    </script>
    <h5 id="result"></h5>
    <div id="map-canvas"></div>
</body>
</html>
